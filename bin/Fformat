#!/bin/bash

. `dirname $0`/Futils.inc

# define command-line options
DEFINE_string 'in' '' 'input file'
DEFINE_string 'type' '' 'input file type, only support js, json, css, html'
DEFINE_string 'out' 'Fformat.out' 'output file'
DEFINE_string 'options' '' 'extra options for specified engine'

# parse the command-line
FLAGS "$@" || exit 1
eval set -- "${FLAGS_ARGV}"

# check the inputs
[ ! -f "${FLAGS_in}" ] && die "no such file (${FLAGS_in})"

type="${FLAGS_type}"
case "${type}" in
  '') die ;;

  js|json|css|html)
    echo "launch ${type}"
    ;;

  *) die "can't support such type (${type})" ;;
esac

echo "${FLAGS_in}"
echo "${FLAGS_type}"
echo "${FLAGS_out}"

if [ "${type}" = "js" ]; then
  # js_beautify貌似有个bug，-o参数没有作用
  perl ${JS_BEAUTIFY} ${FLAGS_options} -s 4 "${FLAGS_in}" > "${FLAGS_out}"
elif [ "${type}" = "json" ]; then
  python "${LIB_HOME}/json_format.py" "${FLAGS_in}" > "${FLAGS_out}"
elif [ "${type}" = "css" ]; then
  echo ''
elif [ "${type}" = "html" ]; then
  echo ''
fi
