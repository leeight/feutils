<project name="closure" basedir=".">
  <property name="src.dir" value="${basedir}" />
  <property name="tools.dir" value="${basedir}/../../tools" />
  <property name="gcl.dir" value="/home/leeight/dev/closure-library/closure/goog/" />
  <property name="build.dir" value="${basedir}/build" />
  <property name="gcc.trunk.jar" value="/home/leeight/dev/closure-compiler/build/compiler.jar" />

  <target name="clean" description="delete generated files">
    <delete dir="${build.dir}" />
  </target>

  <target name="build" depends="clean">
    <script language="javascript" src="app/ant.lib.js">
    <![CDATA[
      calcdeps(_("inputfile"), {
        "level" : "ADVANCED_OPTIMIZATIONS",
        "extraflags" : [
          '-f "--jscomp_warning=checkTypes"',
          '-f "--externs=ui/externs.js"',
          '-f "--formatting=PRETTY_PRINT"',
          '-p "../test/app"'
        ]
      });
      
      var build_dir = _("build.dir");

      yui(build_dir + "/app.js", build_dir + "/app.yui.compiled.js");
      yui(build_dir + "/app.css", build_dir + "/app.yui.compiled.css");

      copy(dirname(_("inputfile")) + '/app.html', build_dir + '/app.html');
    ]]>
    </script>
  </target>

  <target name="checksum">
    <script language="javascript" src="app/ant.lib.js">
    <![CDATA[
      var build_dir = _("build.dir");
      var file_list = ["app.js", "app.gcc.compiled.js", "app.yui.compiled.js",
                       "app.css", "app.yui.compiled.css", "app.html"];
      for (var i = 0; i < file_list.length; i ++) {
        gen_checksum(build_dir + "/" + file_list[i]);
      }
    ]]>
    </script>
  </target>

  <target name="test">
    <script language="javascript" src="app/ant.lib.js">
    <![CDATA[
      gcc("base.js", "a.js");
    ]]>
    </script>
  </target>

  <target name="plovr">
    <script language="javascript" src="app/ant.lib.js">
    <![CDATA[
      exec('java', [
        '-jar ' + getPath(_('tools.dir') + '/lib/plovr.jar'),
        'build',
        'plovr-config.js'
      ]);
    ]]>
    </script>
  </target>
</project>
