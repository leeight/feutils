<!DOCTYPE html>
<html>
	<head>
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
		<script src="https://github.com/malsup/form/raw/master/jquery.form.js"></script>
		<script>
			function showResponse(data) {
				$("#action-result-body").empty();
				var lines = data.split("\n");
				for (var i = 0; i < lines.length; i++) {
					var line = lines[i];
					var indent = 0;
					for (var j = 0; j < line.length; j++) {
						if (line[j] == '\t') {
							indent++;
						} else {
							break;
						}
					}
					htmlcode = "<p style=\"padding-left:" + indent * 2 + "em;margin:0\">" + line + "</p>";
					$("#action-result-body").append(htmlcode);
				}
			}
			$(document).ready(function(){
				$("#button-get-user").click(function(){
					$.post(
						"/debug/getUser",
						{},
						function(data) {
							if (data.success == "true") {
								$("#form-user-id").val(data.result.userId);
								$("#form-user-name").val(data.result.userName);
								$("#form-user-role :input:checked").attr("checked", false);
								if (data.result.userRole == 1) {
									$("#form-user-role-admin").attr("checked", true);
								} else if (data.result.userRole == 2) {
									$("#form-user-role-sale").attr("checked", true);
								} else if (data.result.userRole == 3) {
									$("#form-user-role-service").attr("checked", true);
								} else if (data.result.userRole == 4) {
									$("#form-user-role-customer").attr("checked", true);
								}
							} else {
								alert("No user");
							}
						},
						"json"
					);
				});
				$("#button-set-user").click(function(){
					$.post(
						"/debug/setUser",
						{
							id: $("#form-user-id").val(),
							name: $("#form-user-name").val(),
							role_id: $("#form-user-role :input:checked").val()
						},
						function(data) {
							if (data.success == "true") {
								alert("success");
							} else {
								alert("failed");
							}
						},
						"json"
					);
				});
				$("#json-action-post").click(function(){
					$("#action-result-body").html("<p>waiting response...</p>");
					if ($("#action-param").val() == "") {
						$("#action-param").val("{}");
					}
					$.post(
						$("#json-action-path").val(),
						$("#action-param").val(),
						function(data) {
							showResponse(data);
						},
						"text"
					);
				});
				$("#upload-action-post").click(function (){
					$("#upload-form").ajaxSubmit({
						beforeSubmit: function() {
							$("#upload-file").attr("name", $("#upload-file-name").val());
							$("#upload-form").attr("action", $("#upload-action-path").val());
						},
						success: function(data) {
							showResponse(data);
						},
						type: "POST",
						url: $("#upload-action-path").val(),
						dataType: "text"
					});
				});
			});
		</script>
	</head>
	<body>
		<h1>DAN Debug</h1>
		<hr/>
		<div style="float:right;margin-left:20px">
			<h2>User</h2><br>
			<form id="form-user" method="POST" action="">
				<table>
					<tr>
						<td>id</td>
						<td><input id="form-user-id" type="text" name="userId"></td>
					</tr>
					<tr>
						<td>name</td>
						<td><input id="form-user-name" type="text" name="userName"></td>
					</tr>
					<tr>
						<td>role</td>
						<td id="form-user-role">
							<input id="form-user-role-admin" type="radio" name="userRole" value="1">管理员<br>
							<input id="form-user-role-sale" type="radio" name="userRole" value="2">销售<br>
							<input id="form-user-role-service" type="radio" name="userRole" value="3">客服<br>
							<input id="form-user-role-customer" type="radio" name="userRole" value="4">客户<br>
						</td>
					</tr>
				</table>
			</form>
			<input id="button-get-user" type="button" value="get">
			<input id="button-set-user" type="button" value="set">
		</div>
		<div>
			<div id="action-result-border" style="float:right;border:1px solid black;padding:10px;margin:10px;width:500px">
				<div id="action-result-title"><h3>Response</h3></div>
				<div id="action-result-body"></div>
			</div>
		</div>
		<div>
			<h2>JSON Action</h2><br>
			<p>PATH: <input id="json-action-path" type="text" style="width:200px"><input id="json-action-post" type="button" value="post"></p>
			<p>Parameters: (key=value&amp;key=value...)</p>
			<p><textarea id="action-param" rows="10" cols="40"></textarea></p>
		</div>	
		<hr>
		<div>
			<h2>UPLOAD Action</h2><br>
			<form id="upload-form" enctype="multipart/form-data" method="post">
			<p>PATH: <input id="upload-action-path" type="text" style="width:200px"><input id="upload-action-post" type="button" value="upload"></p>
			<p>File field name: <input id="upload-file-name" type="text"></p>
			<p>File: <input id="upload-file" type="file"></p>
			</form>
		</div>	
	</body>
</html>
