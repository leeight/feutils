<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>ui.ReportCalendar</title>
  <link rel="stylesheet" type="text/css" href="../../src/css/base.css" />
  <link rel="stylesheet" type="text/css" href="../../src/css/ui-month.css" />
  <link rel="stylesheet" type="text/css" href="../../src/css/ui-button.css" />
  <link rel="stylesheet" type="text/css" href="../../src/css/ui-mcal.css" />
  <link rel="stylesheet" type="text/css" href="../../src/css/ui-mmcal.css" />
  <script type="text/javascript" src="../../base.js"></script>
  <script type="text/javascript">
    goog.require("baidu");
    goog.require("base.DateRangeConverter");
    goog.require("ui.Page");
    goog.require("ui.ReportCalendar");
  </script>
  <script type="text/javascript" src="../fet.js"></script>
</head>
<body>
<div id="Main" class="container">
  <div ui="type:ReportCalendar;id:rc;defaultMode:@defaultMode;paramValue:@paramValue;converter:&base.dateRangeConverter"></div>
</div>
<script type="text/javascript">
fet.getTemplate('ui/ReportCalendar.html');

var model = {
};
var page = fet.testControl(model),
    rc = page.c('rc'),
    mmc = rc.c('mmc'),
    mc = rc.c('mc');
    
function assertSelected(index) {
    equals(baidu.dom.hasClass(baidu.g(mmc.getId('option') + index),
        'ui-mmcal-option-selected'), true, 'pass test');
}
    
test("init", function() {
    assertSelected(0);
});

test("mode0", function() {
    rc.rebindModel({
        defaultMode: 0,
    });
    assertSelected(0);
});

test("mode1", function() {
    rc.rebindModel({
        defaultMode: 1,
    });
    assertSelected(1);
});

test("mode2", function() {
    rc.rebindModel({
        defaultMode: 2,
    });
    assertSelected(2);
});

test("today", function() {
    var date = baidu.date.format(new Date(), 'yyyyMMdd');
    rc.rebindModel({
        paramValue: date + '000000,' + date + '235959'
    });
    assertSelected(0);
});

test("yesterday", function() {
    var now = new Date(), date;    
    now.setDate(now.getDate() - 1);
    date = baidu.date.format(now, 'yyyyMMdd');
    rc.rebindModel({
        paramValue: date + '000000,' + date + '235959'
    });
    assertSelected(1);
});

test("last7days", function() {
    var now = new Date(), begin, end;
    now.setDate(now.getDate() - 1);
    end = baidu.date.format(now, 'yyyyMMdd');
    now.setDate(now.getDate() - 6);
    begin = baidu.date.format(now, 'yyyyMMdd');
    rc.rebindModel({
        paramValue: begin+ '000000,' + end + '235959'
    });
    assertSelected(2);
});

test("last10days", function() {
    var now = new Date(), begin, end;
    now.setDate(now.getDate() - 1);
    end = baidu.date.format(now, 'yyyyMMdd');
    now.setDate(now.getDate() - 9);
    begin = baidu.date.format(now, 'yyyyMMdd');
    rc.rebindModel({
        paramValue: begin+ '000000,' + end + '235959'
    });
    equals(baidu.dom.hasClass(baidu.g(mmc.getId('option0')),
        'ui-mmcal-option-selected'), false, 'pass test');
    equals(baidu.dom.hasClass(baidu.g(mmc.getId('option1')),
        'ui-mmcal-option-selected'), false, 'pass test');
    equals(baidu.dom.hasClass(baidu.g(mmc.getId('option2')),
        'ui-mmcal-option-selected'), false, 'pass test');
    equals(baidu.g(mc.getId('show')).innerHTML.replace(/-/g, ''),
        begin + ' è‡³ ' + end);
});
</script>
</body>
</html>
